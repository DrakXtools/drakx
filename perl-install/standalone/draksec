#!/usr/bin/perl

use lib qw(/usr/lib/libDrakX);

use standalone;     #- warning, standalone must be loaded very first, for 'explanations'

use common;
use interactive;
use log;
use security::msec;

local $_ = join '', @ARGV;


/-h/ and die "usage: draksec [--expert]\n";

$::expert = /-expert/ || cat_("/etc/sysconfig/system") =~ /^CLASS="?expert/m; #"
$::isEmbedded = ($::XID, $::CCPID) = "@ARGV" =~ /--embedded (\w+) (\w+)/;

my $in = 'interactive'->vnew('su', 'security');

begin:
$::isEmbedded and kill USR2, $::CCPID;

my $security = security::msec::get_secure_level('');
my $libsafe = security::msec::config_libsafe('');
my $sec_user = security::msec::config_security_user('');
my $w;

security::main($in, $security, $sec_user);

!$::isEmbedded ? $in->exit(0) : kill(USR1, $::CCPID);
goto begin;
