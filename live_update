#!/bin/sh

message=/usr/X11R6/bin/gmessage
[ -x $message ] || message=/usr/X11R6/bin/xmessage
[ -x $message ] || unset message

if [ "$UID" -ne 0 ]; then
    if [ -x "$message" ]; then
	case "$LANG" in
	    fr*) buttons="Arrêter:0"
		 msg="Mise à jour en direct de Mandrake Linux.

Vous devez être l'utilisateur root pour lancer cette application." ;;
	    *) buttons="Abort:0"
	       msg="Mandrake Linux live upgrade.

You need to be root to start this program." ;;
	esac
	$message -buttons "$buttons" -print "$msg"
    else
	echo >&2 "You need to be root to start this program."
    fi
    exit 3
fi

distrib=`pwd`;
if [ ! -x "$distrib/Mandrake/mdkinst/usr/bin/perl-install/live_install" ]; then
    distrib="/mnt/cdrom"
fi
if [ ! -x "$distrib/Mandrake/mdkinst/usr/bin/perl-install/live_install" ]; then
    if [ -x "$message" ]; then
	case "$LANG" in
	    fr*) buttons="Arrêter:0"
		 msg="Mise à jour en direct de Mandrake Linux.

Impossible de trouver le Cédérom d'installation de Mandrake Linux dans le premier lecteur." ;;
	    *) buttons="Abort:0"
	       msg="Mandrake Linux live upgrade.

Unable to find Mandrake Linux Installation Cd-Rom in the first drive." ;;
	esac
	$message -buttons "$buttons" -print "$msg"
    else
	echo >&2 "Unable to find Mandrake Linux Installation Cd-Rom in the first drive."
    fi
    exit 2
fi

if [ -x "$message" ]; then
    case "$LANG" in
	fr*) buttons="Mise à jour:0,Annuler:1"
	     msg="Mise à jour en direct de Mandrake Linux.

Appuyez sur \"Mise à jour\" pour lancer la mise à jour de votre système,
cela prendra quelques minutes avant que l'écran de DrakX apparaisse.

Appuyez sur \"Annuler\" pour ne pas mettre à jour votre système de cette manière." ;;
	*) buttons="Upgrade:0,Cancel:1"
	   msg="Mandrake Linux live upgrade.

Press \"Upgrade\" to start live upgrade on your system, note this will
take some time to prepare the system before DrakX screen appears.

Press \"Cancel\" to avoid upgrading your system this way." ;;
    esac
    default=`echo $buttons | cut -d: -f1`
    $message -buttons "$buttons" -default "$default" -print "$msg"
    [ $? -ne 0 ] && exit 1
else
    echo >&2 "Press ENTER to start live upgrade on your system, note this will
take some time to prepare the system before DrakX screen appears.

Press CTRL-C to avoid upgrading your system this way."
fi

cd "$distrib/Mandrake/mdkinst/usr/bin/perl-install" && exec ./live_install
exit 2
