#!/bin/sh
# compile multiple grub stages (1, 2, pxegrub and nbgrub) for all supported network cards
LOCALPATH=`pwd`
PATHGRUB="../grub-0.91" # Path were grub is stored
DRIVERTOCOMPILE=`grep NETBOOT_DRIVERS= ${PATHGRUB}/configure.in | cut -d " " -f 4 | cut -d "." -f 1`

echo "Cleaning old drivers"
for i in `ls`
do
	if [ -d $i ]; then
	rm -rf $i
	fi
	
done

cd ${PATHGRUB}

echo "Compiling new ones"
for i in ${DRIVERTOCOMPILE}
	do
	make clean
	./configure --enable-$i --enable-diskless
	make 
	mkdir ${LOCALPATH}/$i
	cp stage1/stage1 ${LOCALPATH}/$i/stage1
	cp stage2/stage2 ${LOCALPATH}/$i/stage2
	cp stage2/pxegrub ${LOCALPATH}/$i/pxegrub
	cp stage2/nbgrub ${LOCALPATH}/$i/nbgrub
	echo "compil done for " $i
done
cp ${PATHGRUB}/grub/grub ${LOCALPATH} -f
