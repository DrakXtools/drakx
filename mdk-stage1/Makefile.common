 # -*- makefile -*-
 #******************************************************************************
 #
 # Guillaume Cottenceau (gc@mandriva.com)
 #
 # Copyright 2000 Mandriva
 #
 # This software may be freely redistributed under the terms of the GNU
 # public license.
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 #
 #*****************************************************************************

ARCH := $(patsubst i%86,i386,$(shell uname -m))
ARCH := $(patsubst sparc%,sparc,$(ARCH))
ARCH := $(patsubst arm%,arm,$(ARCH))


# DEBUG = 1

 #- default frontend is newt (honoured by main Makefile whenever possible)
ifdef DEBUG
F = STDIO
else
F = NEWT
endif

ifdef UCLIBC
CC=uclibc-gcc
else
# diet libc syscalls are broken on mips
ifneq (mips, $(ARCH))
# diet libc eabi support is mostly broken
ifneq (arm, $(ARCH))
DIET = $(shell test -x /usr/bin/diet && echo diet)
endif
endif
endif

ifdef UCLIBC
L = UCLIBC
else
ifeq ($(DIET), diet)
 #- default lib is dietlibc (honoured by main Makefile whenever possible)
L = DIETLIBC
else
L = GLIBC
endif
endif

ifdef DEBUG
OPTFLAGS = -g
else
OPTFLAGS = -Os
endif

#- flags used by all stuff
CFLAGS = $(OPTFLAGS) -pipe -Wall -fomit-frame-pointer -fno-strict-aliasing

ifneq (ppc, $(ARCH))
ifneq (sparc, $(ARCH))
CFLAGS += -Werror
endif
endif

DIETLIBC_INCLUDES = -I/usr/lib/dietlibc/include -I.
DIETLIBC_LIBC = /usr/lib/dietlibc/lib-$(ARCH)/libcompat.a
GLIBC_INCLUDES = -I.
UCLIBC_INCLUDES = -I.
INCLUDES = $($(L)_INCLUDES)

GLIBC_LDFLAGS = -static
LDFLAGS = $($(L)_LDFLAGS)

STAGE1_LIBC = $($(L)_LIBC)

ifdef DEBUG
STRIPCMD = echo not stripping
else
STRIPCMD = strip -R .note -R .comment
endif

