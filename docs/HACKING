-=-=--
DrakX is a very big project, and it needs special setups to work.
The purpose of this file is to explain how you can setup your box to make it
compile and run.
-=-=--

Beware, don't try this on a production machine with important data.


--------------------------------------------------------------------------
Sources installation:

  First grab the gi.tar.bz2 archive and untar it in your home directory,
for example from DrakX-*.src.rpm on your Mandrake Linux distribution.

cd to gi
for i in `du -a | grep CVS/Root | cut -f 2`
do
  sed -e 's/prigaux/anoncvs/' $i > $i.tmp
  mv $i.tmp $i
done

Then, log yourself into the cvs:
% export CVS_RSH=ssh
% export CVSROOT=:ext:anoncvs@cvs.mandrakesoft.com:/cooker
% cvs checkout gi
	(passwd: 'cvs')
And update the gi package:
cvs update -P -d


--------------------------------------------------------------------------
Preparing the compilation process:

(1) target directory

create a /export directory and copy a recent Mandrake Linux CD in there.
(You don't have to put have all the RPMS...) ; you'll need roughly 1.5
Gbytes for a full install.

[gc@obiwan ~/cvs/gi] su -c "mkdir /export"


(2) devel packages

you need quite a few devel packages to run the stuff; roughly: gcc, make,
glibc-devel, perl-devel, XFree86-devel, libglib-devel, libgtk+-devel,
perl-GTK, ldetect*, libslang-devel, libnewt-devel, e2fsprogs, dosfstools,
rpm-devel, popt-devel, rpmtools, libbzip2*, libncurses*.

you may need a few others I forgot to mention. if the compilation
fails, try to understand the message and install any necessary
remaining package.


(3) sudo

never build or run DrakX as root; install package sudo, and set up
relevant permissions; the following should be enough: (in your
/etc/sudoers)

gc ALL=(root) NOPASSWD:/usr/bin/patch,NOPASSWD:/bin/rpm,NOPASSWD:/bin/mount,NOPASSWD:/bin/cp,NOPASSWD:/bin/umount,NOPASSWD:/usr/bin/install,NOPASSWD:/bin/rm,NOPASSWD:/bin/mv,NOPASSWD:/bin/tar,NOPASSWD:/bin/cpio,NOPASSWD:/bin/chown,NOPASSWD:/bin/mkdir,NOPASSWD:/usr/bin/strip,NOPASSWD:/bin/mknod


(4) boot kernel

you need one or more kernels and (all?) their modules. it's
located in the subdirectory "all.kernels" of the "gi/kernel"
directory; if you ever grab (or build) another boot kernel,
replace or add an entry in "all.kernels" as:

[gc@obiwan ~/cvs/gi/kernel/all.kernels] mkdir 2.4.1-BOOTcustom
[gc@obiwan ~/cvs/gi/kernel/all.kernels] cd 2.4.1-BOOTcustom
[gc@obiwan ~/cvs/gi/kernel/all.kernels/2.4.1-BOOTcustom] tar jxvf ~/mycustomkernel.tar.bz2
[gc@obiwan ~/cvs/gi/kernel/all.kernels/2.4.1-BOOTcustom] ls
boot/  lib/


(5) pray

[gc@obiwan ~/cvs/gi] make


---------------------------------------------------------------------------
The comments written with #- are automatically stripped out at install.


---------------------------------------------------------------------------
testing all:

  go to the perl-install directory and execute ./install2 --test

  NEVER execute DrakX as root! You might need to allow all users
  to read the block devices of your hard-disks, though (chmod a+w
  /dev/hda* for example).



Here is how I (dams) made it work on my computer.
-------------------------------------------------

- get the sources
- install the librairies needed included newt-devel gtk+-devel popt-devel popt gtk-engines
- cd path/to/gi
- make
- mkdir /usr/share/gtk
- ln -s path/to/gi/perl-install/share/themes /usr/share/gtk
- ln -s path/to/gi/perl-install/share/step-* /usr/share
- ln -s path/to/gi/perl-install/share/help.xpm /usr/share
- ln -s path/to/gi/perl-install/share/isdn* /etc/sysconfdir/network-scripts
- have a cd architecture linked on /export
- ln -s /export /tmp/rhimage
- export PERL_INSTALL_TEST=1
- cd path/to/gi/perl-install
- gendistrib --noclean --distrib /export
- ./install2 in root (dangerous) or chmod a+r /dev/hd* and ./install2 in user



address all bugreports to dave@null.com
